<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HD Collage Generator</title>

<style>
  body {
    margin: 0;
    font-family: sans-serif;
    padding-bottom: 100px; /* So content never hides under buttons */
    background: #f5f5f5;
  }

  .container {
    padding: 16px;
  }

  /* ----- FIXED BUTTON BAR ----- */
  .actions {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;

    display: flex;
    justify-content: space-between;
    gap: 12px;

    padding: 14px;
    background: #ffffff;
    box-shadow: 0 -2px 12px rgba(0,0,0,0.20);
    z-index: 9999;
  }

  .actions button {
    flex: 1;
    padding: 14px 0;
    border: none;
    border-radius: 8px;
    background: #f28c2b;
    color: #fff;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
  }

  .actions button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Canvas preview */
  #finalCanvas {
    max-width: 100%;
    display: none;
    margin-top: 20px;
    border: 1px solid #ddd;
  }
</style>
</head>

<body>

<div class="container">
  <h2>HD Collage Generator</h2>

  <input type="file" id="imageInput" multiple accept="image/*">

  <canvas id="finalCanvas"></canvas>
</div>

<!-- -------- BUTTON BAR -------- -->
<div class="actions">
  <button id="generateBtn">Generate Collage</button>
  <button id="downloadBtn" disabled>Download Final Image</button>
</div>

<script>
document.getElementById("generateBtn").onclick = async function () {
  const files = document.getElementById("imageInput").files;

  if (!files.length) {
    alert("Please select images first.");
    return;
  }

  document.getElementById("downloadBtn").disabled = true;

  // Load images
  const images = [];
  for (let f of files) {
    const img = new Image();
    img.src = URL.createObjectURL(f);
    await img.decode();
    images.push(img);
  }

  // Grid: always 2 per row
  const imgWidth = 800;     // HD quality
  const imgHeight = 800;    // square format

  const rowWidth = imgWidth * 2;
  const rows = Math.ceil(images.length / 2);

  const finalWidth = rowWidth;
  const finalHeight = rows * imgHeight;

  const canvas = document.getElementById("finalCanvas");
  const ctx = canvas.getContext("2d");

  canvas.width = finalWidth;
  canvas.height = finalHeight;

  // White background
  ctx.fillStyle = "#ffffff";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Draw images
  images.forEach((img, i) => {
    const row = Math.floor(i / 2);
    const col = i % 2;

    // If last row has uneven images â†’ fill full width
    if (images.length % 2 !== 0 && i === images.length - 1) {
      ctx.drawImage(img, 0, row * imgHeight, finalWidth, imgHeight);
    } else {
      ctx.drawImage(img, col * imgWidth, row * imgHeight, imgWidth, imgHeight);
    }
  });

  canvas.style.display = "block";
  document.getElementById("downloadBtn").disabled = false;
};

document.getElementById("downloadBtn").onclick = function () {
  const canvas = document.getElementById("finalCanvas");
  const link = document.createElement("a");
  link.download = "HD-Collage.png";
  link.href = canvas.toDataURL("image/png", 1.0);
  link.click();
};
</script>

</body>
</html>
